2025-11-10 03:54:06,135 - scheduler - INFO - Starting scheduler service...
2025-11-10 03:54:06,580 - scheduler - ERROR - Failed to initialize scheduler database: Index build failed: 25db33bc-2a1c-4efc-a334-2bb1f38512a9: Collection books.checkpoints ( 7eb656ac-5e2c-4133-bf09-58552b2b7352 ) :: caused by :: E11000 duplicate key error collection: books.checkpoints index: unique_checkpoint_type dup key: { checkpoint_type: null }, full error: {'ok': 0.0, 'errmsg': 'Index build failed: 25db33bc-2a1c-4efc-a334-2bb1f38512a9: Collection books.checkpoints ( 7eb656ac-5e2c-4133-bf09-58552b2b7352 ) :: caused by :: E11000 duplicate key error collection: books.checkpoints index: unique_checkpoint_type dup key: { checkpoint_type: null }', 'code': 11000, 'codeName': 'DuplicateKey', 'keyPattern': {'checkpoint_type': 1}, 'keyValue': {'checkpoint_type': None}}
2025-11-10 03:54:06,582 - scheduler - ERROR - Failed to start scheduler: Index build failed: 25db33bc-2a1c-4efc-a334-2bb1f38512a9: Collection books.checkpoints ( 7eb656ac-5e2c-4133-bf09-58552b2b7352 ) :: caused by :: E11000 duplicate key error collection: books.checkpoints index: unique_checkpoint_type dup key: { checkpoint_type: null }, full error: {'ok': 0.0, 'errmsg': 'Index build failed: 25db33bc-2a1c-4efc-a334-2bb1f38512a9: Collection books.checkpoints ( 7eb656ac-5e2c-4133-bf09-58552b2b7352 ) :: caused by :: E11000 duplicate key error collection: books.checkpoints index: unique_checkpoint_type dup key: { checkpoint_type: null }', 'code': 11000, 'codeName': 'DuplicateKey', 'keyPattern': {'checkpoint_type': 1}, 'keyValue': {'checkpoint_type': None}}
2025-11-10 03:54:06,583 - scheduler - ERROR - Scheduler error: Index build failed: 25db33bc-2a1c-4efc-a334-2bb1f38512a9: Collection books.checkpoints ( 7eb656ac-5e2c-4133-bf09-58552b2b7352 ) :: caused by :: E11000 duplicate key error collection: books.checkpoints index: unique_checkpoint_type dup key: { checkpoint_type: null }, full error: {'ok': 0.0, 'errmsg': 'Index build failed: 25db33bc-2a1c-4efc-a334-2bb1f38512a9: Collection books.checkpoints ( 7eb656ac-5e2c-4133-bf09-58552b2b7352 ) :: caused by :: E11000 duplicate key error collection: books.checkpoints index: unique_checkpoint_type dup key: { checkpoint_type: null }', 'code': 11000, 'codeName': 'DuplicateKey', 'keyPattern': {'checkpoint_type': 1}, 'keyValue': {'checkpoint_type': None}}
2025-11-10 03:54:06,584 - scheduler - ERROR - Error shutting down scheduler: Scheduler is not running
2025-11-10 03:54:06,585 - scheduler - ERROR - Scheduler service failed: Scheduler is not running
Traceback (most recent call last):
  File "C:\Users\ADMIN\Documents\web_crawler_project\src\scheduler\scheduler.py", line 135, in run_scheduler
    await scheduler.start()
  File "C:\Users\ADMIN\Documents\web_crawler_project\src\scheduler\scheduler.py", line 112, in start
    await init_scheduler_db()
  File "C:\Users\ADMIN\Documents\web_crawler_project\src\scheduler\db_setup.py", line 143, in init_scheduler_db
    await store.init_indexes()
  File "C:\Users\ADMIN\Documents\web_crawler_project\src\crawler\store.py", line 43, in init_indexes
    await self.checkpoints.create_index(
  File "C:\Users\ADMIN\AppData\Local\Programs\Python\Python310\lib\concurrent\futures\thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
  File "C:\Users\ADMIN\Documents\web_crawler_project\myvenv\lib\site-packages\pymongo\synchronous\collection.py", line 2387, in create_index
    return (self._create_indexes([index], session, **cmd_options))[0]
  File "C:\Users\ADMIN\Documents\web_crawler_project\myvenv\lib\site-packages\pymongo\_csot.py", line 125, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\ADMIN\Documents\web_crawler_project\myvenv\lib\site-packages\pymongo\synchronous\collection.py", line 2261, in _create_indexes
    self._command(
  File "C:\Users\ADMIN\Documents\web_crawler_project\myvenv\lib\site-packages\pymongo\synchronous\collection.py", line 621, in _command
    return conn.command(
  File "C:\Users\ADMIN\Documents\web_crawler_project\myvenv\lib\site-packages\pymongo\synchronous\helpers.py", line 47, in inner
    return func(*args, **kwargs)
  File "C:\Users\ADMIN\Documents\web_crawler_project\myvenv\lib\site-packages\pymongo\synchronous\pool.py", line 413, in command
    return command(
  File "C:\Users\ADMIN\Documents\web_crawler_project\myvenv\lib\site-packages\pymongo\synchronous\network.py", line 212, in command
    helpers_shared._check_command_response(
  File "C:\Users\ADMIN\Documents\web_crawler_project\myvenv\lib\site-packages\pymongo\helpers_shared.py", line 274, in _check_command_response
    raise DuplicateKeyError(errmsg, code, response, max_wire_version)
pymongo.errors.DuplicateKeyError: Index build failed: 25db33bc-2a1c-4efc-a334-2bb1f38512a9: Collection books.checkpoints ( 7eb656ac-5e2c-4133-bf09-58552b2b7352 ) :: caused by :: E11000 duplicate key error collection: books.checkpoints index: unique_checkpoint_type dup key: { checkpoint_type: null }, full error: {'ok': 0.0, 'errmsg': 'Index build failed: 25db33bc-2a1c-4efc-a334-2bb1f38512a9: Collection books.checkpoints ( 7eb656ac-5e2c-4133-bf09-58552b2b7352 ) :: caused by :: E11000 duplicate key error collection: books.checkpoints index: unique_checkpoint_type dup key: { checkpoint_type: null }', 'code': 11000, 'codeName': 'DuplicateKey', 'keyPattern': {'checkpoint_type': 1}, 'keyValue': {'checkpoint_type': None}}

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\ADMIN\Documents\web_crawler_project\run_scheduler.py", line 26, in main
    asyncio.run(run_scheduler())
  File "C:\Users\ADMIN\AppData\Local\Programs\Python\Python310\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "C:\Users\ADMIN\AppData\Local\Programs\Python\Python310\lib\asyncio\base_events.py", line 649, in run_until_complete
    return future.result()
  File "C:\Users\ADMIN\Documents\web_crawler_project\src\scheduler\scheduler.py", line 143, in run_scheduler
    scheduler.shutdown()
  File "C:\Users\ADMIN\Documents\web_crawler_project\src\scheduler\scheduler.py", line 125, in shutdown
    self.scheduler.shutdown()
  File "C:\Users\ADMIN\Documents\web_crawler_project\myvenv\lib\site-packages\apscheduler\schedulers\asyncio.py", line 48, in shutdown
    raise SchedulerNotRunningError
apscheduler.schedulers.SchedulerNotRunningError: Scheduler is not running
2025-11-10 03:57:22,890 - scheduler - INFO - Starting scheduler service...
2025-11-10 03:57:23,014 - scheduler - ERROR - Error initializing scheduler indexes: {'key': [('timestamp', -1), ('change_type', 1)], 'name': 'scheduler_changes_lookup'} is not an instance of pymongo.operations.IndexModel
2025-11-10 03:57:23,015 - scheduler - ERROR - Failed to initialize scheduler database: {'key': [('timestamp', -1), ('change_type', 1)], 'name': 'scheduler_changes_lookup'} is not an instance of pymongo.operations.IndexModel
2025-11-10 03:57:23,016 - scheduler - ERROR - Failed to start scheduler: {'key': [('timestamp', -1), ('change_type', 1)], 'name': 'scheduler_changes_lookup'} is not an instance of pymongo.operations.IndexModel
2025-11-10 03:57:23,017 - scheduler - ERROR - Scheduler error: {'key': [('timestamp', -1), ('change_type', 1)], 'name': 'scheduler_changes_lookup'} is not an instance of pymongo.operations.IndexModel
2025-11-10 03:57:23,017 - scheduler - ERROR - Error shutting down scheduler: Scheduler is not running
2025-11-10 03:57:23,018 - scheduler - ERROR - Scheduler service failed: Scheduler is not running
Traceback (most recent call last):
  File "C:\Users\ADMIN\Documents\web_crawler_project\src\scheduler\scheduler.py", line 135, in run_scheduler
    await scheduler.start()
  File "C:\Users\ADMIN\Documents\web_crawler_project\src\scheduler\scheduler.py", line 112, in start
    await init_scheduler_db()
  File "C:\Users\ADMIN\Documents\web_crawler_project\src\scheduler\db_setup.py", line 146, in init_scheduler_db
    await store.init_scheduler_indexes()
  File "C:\Users\ADMIN\Documents\web_crawler_project\src\scheduler\db_setup.py", line 28, in init_scheduler_indexes
    await self.changes.create_indexes([
  File "C:\Users\ADMIN\AppData\Local\Programs\Python\Python310\lib\concurrent\futures\thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
  File "C:\Users\ADMIN\Documents\web_crawler_project\myvenv\lib\site-packages\pymongo\synchronous\collection.py", line 2224, in create_indexes
    return self._create_indexes(indexes, session, **kwargs)
  File "C:\Users\ADMIN\Documents\web_crawler_project\myvenv\lib\site-packages\pymongo\_csot.py", line 125, in csot_wrapper
    return func(self, *args, **kwargs)
  File "C:\Users\ADMIN\Documents\web_crawler_project\myvenv\lib\site-packages\pymongo\synchronous\collection.py", line 2253, in _create_indexes
    cmd = {"createIndexes": self.name, "indexes": list(gen_indexes())}
  File "C:\Users\ADMIN\Documents\web_crawler_project\myvenv\lib\site-packages\pymongo\synchronous\collection.py", line 2246, in gen_indexes
    raise TypeError(
TypeError: {'key': [('timestamp', -1), ('change_type', 1)], 'name': 'scheduler_changes_lookup'} is not an instance of pymongo.operations.IndexModel

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\ADMIN\Documents\web_crawler_project\run_scheduler.py", line 26, in main
    asyncio.run(run_scheduler())
  File "C:\Users\ADMIN\AppData\Local\Programs\Python\Python310\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "C:\Users\ADMIN\AppData\Local\Programs\Python\Python310\lib\asyncio\base_events.py", line 649, in run_until_complete
    return future.result()
  File "C:\Users\ADMIN\Documents\web_crawler_project\src\scheduler\scheduler.py", line 143, in run_scheduler
    scheduler.shutdown()
  File "C:\Users\ADMIN\Documents\web_crawler_project\src\scheduler\scheduler.py", line 125, in shutdown
    self.scheduler.shutdown()
  File "C:\Users\ADMIN\Documents\web_crawler_project\myvenv\lib\site-packages\apscheduler\schedulers\asyncio.py", line 48, in shutdown
    raise SchedulerNotRunningError
apscheduler.schedulers.SchedulerNotRunningError: Scheduler is not running
2025-11-10 03:58:26,553 - scheduler - INFO - Starting scheduler service...
2025-11-10 03:58:26,834 - scheduler - INFO - Scheduler indexes initialized successfully
2025-11-10 03:58:26,869 - scheduler - INFO - Schema version updated successfully
2025-11-10 03:58:26,869 - scheduler - INFO - Scheduler database initialization completed successfully
2025-11-10 03:58:26,873 - scheduler - INFO - Scheduler started successfully
2025-11-10 03:58:38,366 - scheduler - INFO - Scheduler service stopped by user
2025-11-10 04:00:22,274 - scheduler - INFO - Starting scheduler service...
2025-11-10 04:00:22,350 - scheduler - INFO - Scheduler indexes initialized successfully
2025-11-10 04:00:22,353 - scheduler - INFO - Schema version updated successfully
2025-11-10 04:00:22,353 - scheduler - INFO - Scheduler database initialization completed successfully
2025-11-10 04:00:22,356 - scheduler - INFO - Scheduler started successfully
2025-11-10 04:00:34,533 - scheduler - INFO - Scheduler service stopped by user
